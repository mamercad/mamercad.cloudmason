---
- name: concourse
  hosts: localhost
  connection: local
  gather_facts: false
  become: false

  vars:

    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      61333464393462306464303537663766383633323235313337626639323738323937383939363737
      3530303938386365656337376638383833663532346530630a373737653162353038313364333835
      30376537363837346131396136313830646164303662616161313165626466343833386262373365
      6131303031623438620a363838636136383431313338303363396161373866333433336135313139
      3033

  tasks:
    - name: include concourse role (main tasks)
      ansible.builtin.include_role:
        name: concourse
        tasks_from: main.yml
      vars:
        context: thinkpad
        helm_values:
          replicas: 1
          web:
            service:
              api:
                type: LoadBalancer
              workerGateway:
                type: LoadBalancer
          concourse:
            web:
              externalUrl: https://concourse.cloudmason.org
              localAuth:
                enabled: true
              auth:
                mainTeam:
                  localUser: "test,mark"
            secrets:
              create: true
              localUsers: "test:test,mark:{{ password }}"
