- name: create metallb secret
  community.kubernetes.k8s:
    state: present
    definition:
      apiVersion: v1
      data:
        secretkey: "{{ secretkey }}"
      kind: Secret
      metadata:
        name: memberlist
        namespace: metallb-system
      type: Opaque

- name: create metallb configmap
  community.kubernetes.k8s:
    state: present
    definition:
      apiVersion: v1
      data:
        config: |
          address-pools:
          - name: default
            protocol: layer2
            addresses:
            - {{ range }}
      kind: ConfigMap
      metadata:
        name: config
        namespace: metallb-system
