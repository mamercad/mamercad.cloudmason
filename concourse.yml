---
- name: concourse
  hosts: localhost
  connection: local
  gather_facts: false
  become: false

  vars:

    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      30316139393930313339633633646131366165643538333262396635333930386462313863646339
      3961653365663262366364396564383730633061636535380a313936313430636239313562386463
      30636163646163363763353462303866633134356431393264333535623861393836393962356239
      3762363437363862640a663034326230633838356462666132326261393032623463373864643733
      6538
    local_users: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      62653031366138646261333433313839323336663835663865363963366636303764636161356437
      3834623236613336643532666137376631373435343437300a656363663966616263346431363331
      62386664313565363063656338613034663336626331323630663136623034356135643832313430
      6535613864376334650a313932613563663335363439343265323866393238303266643333336233
      33373461396164653138336137626138313763653533626430326232623465393335

  tasks:
    - name: include concourse role (main tasks)
      ansible.builtin.include_role:
        name: concourse
        tasks_from: main.yml
      vars:
        context: thinkpad
        helm_values:
          replicas: 1
          web:
            service:
              api:
                type: LoadBalancer
              workerGateway:
                type: LoadBalancer
          concourse:
            web:
              externalUrl: https://concourse.cloudmason.org
              localAuth:
                enabled: true
              auth:
                mainTeam:
                  localUser: "test,mark"
              enableRedactSecrets: true
            secrets:
              create: true
              localUsers: "test:{{ password }},mark:{{ password }}"
